<nav class="navbar px-10p py-2">
    <!-- <span class="navbar-brand m-0"><a class="text-dark" href="/">STEM Portal</a></span> -->
    <span class="navbar-brand"><a href="/"><img src="/image/logo.svg" alt="site logo"></a></span>
    <!-- collapsed menu trigger -->
    <button class="navbar-toggler text-dark pr-0" data-toggle="collapse" data-target="#collapsed-navigation"
    aria-controls="collapsed-navigation" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars"></i>
    </button>
</nav>
<!-- collapsed menu (should be generated by script) -->
<div id="collapsed-navigation" class="collapse px-10p pb-1 border-top border-muted">
    <ul class="navigation list-group list-group-flush">
        <!-- generated by code -->
    </ul>
    <ul class="list-inline">
        <!-- <li class="list-inline-item"><i class="far fa-adjust"></i></li> high contrast -->
        <li class="list-inline-item mr-2" role="button"><i class="far fa-text-size"></i></li> <!-- text size -->
        <li class="list-inline-item mr-2" role="button" onclick="toggleLanguage()"><i class="fal fa-language"></i></li>
        <!-- Chinese/English switch -->
    </ul>
</div>

<script>
    // should run recursively
    (function (options) {
        $.getJSON(options.jsonUrl, (data) => {
            console.log(data.sub);
            getNavigation(data, ".navigation");
        })
    }({ jsonUrl: "/sitemap.json" }));

    // recursive function to generate the sitemap
    const getNavigation = (dir, appendTo) => {
        dir.sub.forEach(d => {
            if (!d.sub) {
                $(appendTo).append(`<li class="list-group-item px-0" role="listitem"><a class="d-inline-block text-muted" href="${d.url[0]}">${d.name}</a></li>`);
            } else {
                let id = (d.name).replace(/\s+/g, '-');
                let el = $(`<li class="list-group-item px-0" role="list" aria-controls="#${id}" aria-expanded="false">
                        <span role="button" data-toggle="collapse" data-target="#${id}">
                            <span>${d.name}</span>
                            <span class="float-right">+</span>
                        </span>
                        <ul id="${id}" class="collapse list-group list-group-flush px-10p"></ul>
                        </li>`);
                $(appendTo).append(el);
                getNavigation(d, el.find("ul"));
            }
        });
    }

    // switch between Chinese and English
    const toggleLanguage = () => {
        let url = location.href;
        if (!url.includes("_cn")) {
            url = url.replace(".html", "_cn.html");
        } else {
            url = url.replace("_cn.html", ".html");
        }
        console.log(url);
        $.ajax({
            url: url,
            type: 'HEAD',
            error: () => {
                alert('The current page does not support other language');
            },
            success: () => {
                // redirect
                window.location.replace(url);
            }
        });
    }
</script>